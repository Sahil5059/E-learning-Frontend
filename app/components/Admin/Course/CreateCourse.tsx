//STEP: 85 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
"use client";
import React, { useEffect, useState } from 'react';
import CourseInformation from './CourseInformation'; //imported in the 88th step
import CourseOptions from './CourseOptions'; //imported in the 88th step
import CourseData from './CourseData'; //imported in the 91th step
import CourseContent from './CourseContent'; //imported in the 93th step
import CoursePreview from './CoursePreview'; //imported in the 99th step
import { useCreateCourseMutation } from '../../../../redux/features/courses/courseApi'; //imported in the 101th step
import toast from 'react-hot-toast'; //imported in the 101th step
import { redirect } from 'next/navigation'; //imported in the 101th step
import { number } from 'yup';
//defining-props
type Props = {}
//creating-data
const CreateCourse = (props: Props) => {

  //STEP: 101 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  const [createCourse,{isLoading,isSuccess,error}] = useCreateCourseMutation();
  useEffect(() => {
    if(isSuccess){
      toast.success("Course Created Successfully");
      redirect("/admin/courses");
    }
    if(error){
      if("data" in error){
        const errorMessage = error as any;
        toast.error(errorMessage.data.message);
      }
    }
  },[isLoading,isSuccess,error]);
  //OVER: 101 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  const [active, setActive] = useState(0);
  const [courseInfo, setCourseInfo] = useState({
    name: "",
    description: "",
    price: "",
    estimatedPrice: "",
    tags: "",
    level: "",
    categories: "",
    demoUrl: "",
    thumbnail: "",
  });
  const [benefits, setBenefits] = useState([{ title: "" }]);
  const [prerequisits, setprerequisits] = useState([{ title: "" }]);
  const [courseContentData, setCourseContentData] = useState([
    {
        videoUrl: "",
        title: "",
        description: "",
        videoSection: "Untitled Section",
        videoLength: number,
        links: [{ title: "", url: "", }],
        suggestion: "",
    }
  ]);
  const [courseData, setCourseData] = useState({});
  const handleSubmit = async() => {
    
    //STEP: 93 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //watch- 6:00:00 to 6:01:15
    //formatting benefits array
    const formattedBenefits = benefits.map((benefit) => ({title: benefit.title}));
    //formatting prerequisits array
    const formattedprerequisits = prerequisits.map((prerequisite) => ({title: prerequisite.title}));
    //formatting course content array
    const formattedCourseContentData = courseContentData.map((courseContent) => ({
      videoUrl: courseContent.videoUrl,
      title: courseContent.title,
      description: courseContent.description,
      videoLength: courseContent.videoLength,
      videoSection: courseContent.videoSection,
      links: courseContent.links.map((link) => ({
        title: link.title,
        url: link.url,
      })),
      suggestion: courseContent.suggestion
    }));
    //preparing our data-object
    const data = {
      name: courseInfo.name,
      description: courseInfo.description,
      price: courseInfo.price,
      estimatedPrice: courseInfo.estimatedPrice,
      tags: courseInfo.tags,
      categories: courseInfo.categories,
      thumbnail: courseInfo.thumbnail,
      level: courseInfo.level,
      demoUrl: courseInfo.demoUrl,
      totalVideos: courseContentData.length,
      benefits: formattedBenefits,
      prerequisits: formattedprerequisits,
      courseData: formattedCourseContentData
    }
    setCourseData(data);
    //note, "setCourseData()" is an asynchronous function, so use useEffect to "console.log(courseData)" instead of simply console-logging("courseData") or you will get the old "courseData" instaed of the updated one.
    //now, go, create course from start and see the final result on your browser console.
    //OVER: 93 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  }

  //STEP: 96 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  const handleCourseCreate = async(e:any) => {
    const data = courseData;

    //STEP: 102 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    if(!isLoading){
      await createCourse(data);
    } //reason: watch- 6:41:40 to 6:42:25
    //now go ahaed and create-course and then check the Mongo DB database
    //now, we will set-up code to display all courses
    //OVER: 102("c": ../../../admin/courses & ../../../admin/courses/page.tsx ) ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  }
  //OVER: 96("c": ../../../utils/CoursePlayer.tsx and "m": ../../../utils/CoursePlayer.tsx) ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  //returning-data
  return (
    <div className="w-full flex min-h-screen">

        {/* STEP: 89 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*/}
        <div className="w-[80%]">
            {active === 0 && (
                <CourseInformation courseInfo={courseInfo} setCourseInfo={setCourseInfo} active={active} setActive={setActive} />
            )}

            {/* STEP: 91 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*/}
            {active === 1 && (
                <CourseData benefits={benefits} setBenefits={setBenefits} prerequisits={prerequisits} setprerequisits={setprerequisits} active={active} setActive={setActive} />
            )}
            {/* watch- 5:18:55 to 5:20:10 */}
            {/* OVER: 91("c": ./CourseContent.tsx and "m": ./CourseContent.tsx) ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*/}

            {/* STEP: 94 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*/}
            {active === 2 && (
                <CourseContent active={active} setActive={setActive} courseContentData={courseContentData} setCourseContentData={setCourseContentData} handleSubmit={handleSubmit} />
            )}
            {/* OVER: 94("c": ./CoursePreview.tsx and "m": ./CoursePreview.tsx) ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*/}
            
            {/* STEP: 99 ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*/}
            {active === 3 && (
                <CoursePreview active={active} setActive={setActive} courseData={courseData} handleCourseCreate={handleCourseCreate} />
            )}
            {/* OVER: 99("c": ../../../../redux/features/courses & ../../../../redux/features/courses/courseApi.ts and "m"../../../../redux/features/courses/courseApi.ts) ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*/}
        
        </div>
        <div className="w-[20%] mt-[100px] h-screen fixed z-[-1] top-18 right-0">
            <CourseOptions active={active} setActive={setActive}/>
        </div>
        {/* watch- 5:05:40 to 5:06:15  */}
        {/* OVER: 89("c": ./CourseOptions.tsx and "m": ./CourseOptions.tsx) ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*/}
        
    </div>
  )
}
//exporting-data
export default CreateCourse;
//OVER: 85("m": ../../../admin/create-course/page.tsx) ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////